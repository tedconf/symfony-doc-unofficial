symfony アドベントカレンダー 1日目: プロジェクトを立ち上げる
======================================================

挑戦
-------------

symfonyアドベントカレンダーは、12月1日からクリスマスまで毎日発表される全24編のチュートリアルです。 週末を含む毎日、新しいチュートリアルが発表されます。 それぞれのチュートリアルは1時間未満ですが、WEB2.0の現在進行中の進化に関するあらゆることを知る機会になるでしょう。クリスマスには、できあがったアプリケーションはオンライン上で公開され、オープンソースのアプリケーションとして提供されます。 このアプリケーションは、使いやすくて、面白く、便利で、かつ、楽しいものになるはずです。

1時間未満で24回ということは、合計しても1日未満です。それは、私たちが開発者がsymfonyを学ぶのに必要であると考えている時間そのものです。 毎日、新機能がアプリケーションに追加されていきますが、私たちはこの開発を、symfonyを使ったWEB開発のよい練習素材とすると同時に、symfonyの機能性をどのように利用するかを示すために利用するつもりです。 毎日、あなたは、symfonyでウェブアプリケーションを開発するのがどんなに速く・効率的であるかを実感するでしょう。そして、さらに知りたくなるにちがいありません。

たったそれだけではものたりないという割には、われわれが怠惰なせいもあって、21日目 - 冬の時間 - のためのプランが全くありません 。みなさんが最も必要とする機能は、当日、準備なしでアプリケーションに追加されるでしょう。そして、私たちはそれうまくいかせるつもりです。それが、一日でsymfonyの第一人者を得るための日になるでしょう。

プロジェクト
-----------

設計されるアプリケーションはちょっとした「発表会」というようなアプリケーションで、TODOリスト、電話帳、または書店のようなものになるかもしれません。 しかし、我々はsymfonyを、有用で、数多くの特徴があり、有力な規模の独創的なプロジェクトで使用したいと考えています。 その目的は、symofonyは、複雑な状況で、粋なプロフェッショナル・アプリケーションを少しの努力で開発するために使えるということを本当に証明することです。

symfonyウェブサイトが重要な負荷を支えることができるのを示すために、多くの人々が実際にアプリケーションを使ってくれることを願っています。 それによって、このアプリケーションが、実際のサービスをもたらし、既存の必要性に答え、もしくは新しいものを生み出すことになるのです。 ウェブサイトの立ち上げは生きたのストレス実験になるでしょう; これは、サイトがどのくらいの訪問者を支えることができるかをチェックするために、あなたのような謙虚な訪問者…そのサイトに突っ込みをし、ブックマークし、ブログでふれ、実際の生活で話をする…を必要としていることを意味します。

プロジェクトの内容は他の日のためにに秘密しておきます。 私たちには、今日、完全装備のWEB2.0アプリケーションについて説明すること以外に、まだやらねばならないことが多くあります。 他の前提について述べ、着手するためにあなたにもう少し時間が必要でしょう。とはいえ、私たちにはその呼び名が必要ですから、こう呼ぶことにします: **askeet** 。

本日の目的
-----------

今日の目的は、ウェブブラウザでアプリケーションのページを表示することと、プロの開発環境をセットアップすることです。これはsymfonyのインストール、アプリケーションの作成、ウェブサーバ構成、およびソースのバージョン・コントロール・システムのセットアップを含んでいます。

それは、既に以前のチュートリアルをやった人々にとっては簡単で、他の人にはそれほど困難ではありません。 そして、皆、何か新しいものを学ぶでしょう。

私たちは、あなたがApache、MySQL、PHP5がインストールされているUnix系システムを利用していることを想定しています。Windowsで動かしていても、慌てないでください: その環境でも十分機能しますし、コマンドプロンプトにおいて、いくつかのコマンドをタイプする必要があるだけです。

Symfonyインストール
-------------------

symfonyをインストールする最も簡単な方法は [PEAR][1]パッケージを使用することです。しかしながら、チャンネルを使用してsymfonyチャネルにアクセスするため、PEAR1.4.0以上にアップグレードする必要があります。(PEAR1.4.5を含んでいるPHP5.1.0を使っていれば必要ありません）:

    $ pear upgrade PEAR

>**注意**: PEARを使用している間に何か問題が生じたら、[インストール](http://www.symfony-project.com/book/1_0/02-Exploring-Symfony-s-Code)の章を参照してください。

では、'symfony'のチャネルを加えましょう:

    $ pear channel-discover pear.symfony-project.com

これで、symfonyの最新の安定バージョンをすべての依存関係と共にインストールする準備ができました:

    $ pear install symfony/symfony

symfonyのバージョンをチェックするコマンドを使用して、symfonyがインストールされているかチェックしてください:

    $ symfony -V

あなたがこの新しいコマンドラインツールを使ってできることがに興味があるなら、 `symfony -T`をタイプして、利用可能なオプションを表示してください。 また、tgzアーカイブやsvnレポジトリからsymfonyをインストールする方法を見るには [installation](http://www.symfony-project.com/book/1_0/02-Exploring-Symfony-s-Code)の章を読んでみてください。 コミュニティの貢献によって、[the symfony wiki](http://www.symfony-project.com/trac/wiki/InstallingSymfonyWithoutPear)でもPEARを使わないインストール方法が詳しく説明されています。

プロジェクトのセットアップ
--------------------------

symfonyでは、同じデータモデルを共有する **applications**が**projects**に再編成されています。askeetプロジェクトのために、フロントエンドとバックエンドがあるという事実を明らかにすることができます: それは2つのアプリケーションを作ります。 プロジェクトがアプリケーションの外郭構造で、まずはじめに作られなければなりません。そのために必要なのは、ひとつのディレクトリと `symfony init-project` コマンドだけです:

    $ mkdir /home/sfprojects/askeet
    $ cd /home/sfprojects/askeet
    $ symfony init-project askeet

では `symfony init-app` コマンドを使って frontendアプリケーションを作成しましょう:

    $ symfony init-app frontend

おお、速い。

>**注意**: Windowsユーザは、スペースを含まないパスで、symfonyを実行したり、新しいプロジェクトをセットアップしたりする必要があります（これはDocuments and Setting ディレクトリも含みます）。
>**訳注**: 同様に日本語を含むディレクトリも避けたほうがよいかもしれません。

ウェブサービスのセットアップ
----------------------------

### WEBサーバ構成

新しいアプリケーションをアクセスしやすくするように、あなたのApacheの構成を変えましょう。プロの間では、バーチャルホストとして新しいアプリケーションをセットアップするほうがよく、それをここで説明します。しかしながら、エイリアスとしてそれを加えるのを好むなら、[web server configuration](http://www.symfony-project.com/cookbook/1_0/web_server)の章でその方法を見つけてください。

あなたの Apache/conf/ ディレクトリの `httpd.conf` ファイルを開いて、終わりに加えてください:

    <VirtualHost *:80>
      ServerName askeet
      DocumentRoot "/home/sfprojects/askeet/web"
      DirectoryIndex index.php
      Alias /sf /usr/local/lib/php/data/symfony/web/sf

      <Directory "/home/sfprojects/askeet/web">
       AllowOverride All
      </Directory>
    </VirtualHost>

>**注意**: `/sf` エイリアスはあなたのPEARデータディレクトリにsymfonyのフォルダを指定しなければなりません。それを決定するには、 `pear config-show` をタイプしてください。 symfonyアプリケーションは、WEBデバッグツールバーとAJAXヘルパーを動かすのに必要な画像とjavascriptファイルを得るためにこのフォルダーにアクセスできる必要があります。

Windowsでは、あなたは、`Alias`ラインを以下のように置き換える必要があります。

    Alias /sf "C:\php\pear\data\symfony\web\sf"

### ドメイン名を宣言

ドメイン名 `askeet`がローカルで宣言されなければなりません。

あなたがLinux系OSを使っているなら、 `/etc/hosts`の中で宣言しなければなりません。 Windows XPを使っているなら、このファイルは `C:\Windows\system32\driver\etc\` ディレクトリにあります。

以下の行を追加してください:

    127.0.0.1         askeet

>**注意**: この作業には管理者権限を持っている必要があります。

新しいホストをセットアップしたくないなら、あなたは、別のポートでウェブサイトを配信できるように `Listen` ステートメントを加えてください。 これで、localhostドメインを使用できます。

### 新しい構成をテストする

Apacheをリスタートし、新しいアプリケーションにアクセスできるかチェックしてください:

    http://askeet/ 

![Congratulations](/images/askeet/congratulations.gif)

>**注意**: symfonyは、URLの/index.php/部分を取り除くのに `mod_rewrite`モジュールを使用することができます。
>もし、あなたがそれを使用したくないか、またはあなたのウェブサーバが同等な設備を持っていないなら、あなたは web/ディレクトリに位置する `.htaccess`ファイルを取り除いてください。
>もしあなたのApacheが `mod_rewrite` を含まずにコンパイルされているなら、mod_rewriteのDSOがインストールされていて、`httpd.conf` に以下の行があるかをチェックしてください:
>
>    AddModule mod_rewrite.c
>    LoadModule rewrite_module modules/mod_rewrite.so
>
> [routing chapter](http://www.symfony-project.com/book/1_0/09-Links-and-the-Routing-System)において、smart URLs に関してさらに学ぶこともできます。

また、開発環境におけるアプリケーションにアクセスしましょう。 以下のURLを入力してください:

    http://askeet/frontend_dev.php/ 

ウェブデバッグツールバーは先頭の右隅に表示されます。それは、`Alias sf/` コンフィギュレーションが正しいと立証する小さいアイコンを含んでいます。

![web debug toolbar](/images/askeet/web_debug1.gif)

再度いいますが、Windows環境でIISサーバを実行する場合は、セットアップは少し異なっています。 [related tutorial](http://www.symfony-project.com/cookbook/1_0/web_server_iis)にて設定方法を確かめてください。

Subversion
----------

ずぼらな人々の良い原則の1つは、既存のコードが壊れるのを心配しないことです。 速く仕事を進めたいとき、変更の効果がないとき旧バージョンに戻りたいと思うとき、1人以上の人がプロジェクトにかかわるのを可能にしたいと思うとき、また、アプリケーションのすべてのバージョンにアクセスする手段が欲しいと思うときには、バージョンコントロールを採用しましょう。 この目的のため、 [Subversion][3]が使えます。既にSubversionサーバをインストールしているか、またはSubversionサーバにアクセスする手段を持っていると仮定して話をします。

まず、 askeetのために、新しいレポジトリーを作成してください。

    $ svnadmin create $SVNREP_DIR/askeet
    $ svn mkdir -m "layout creation" file:///$SVNREP_DIR/askeet/trunk file:///$SVNREP_DIR/askeet/tags file:///$SVNREP_DIR/askeet/branches

次に、 `cathe/`と `log/`にある一時的なファイルを除いて、あなたは最初の取り込みをしなければなりません:

    $ cd /home/sfprojects/askeet
    $ rm -rf cache/*
    $ rm -rf log/*
    $ svn import -m "initial import" . file:///$SVNREP_DIR/askeet/trunk

今度は、初期状態のアプリケーションがあるディレクトリを取り除き、SVNバージョンのチェックアウトを使用してください:

    $ cd /home/sfprojects
    $ mv askeet askeet.origin
    $ svn co file:///$SVNREP_DIR/askeet/trunk/ askeet/
    $ ls askeet

    $ rm -rf askeet.origin

１つセットアップするものが残っています。 リポジトリーにあなたの作業ディレクトリをコミットするなら、プロジェクトの `cache/`や`log/`ディレクトリにあるような、いくつかの不要なファイルをコピーしてしまうかもしれません。 したがって、このプロジェクトのSVNへの無視リストを特定する必要があります。

    $ cd /home/sfprojects/askeet
    $ svn propedit svn:ignore cache

SVNのためにコンフィギュアされたデフォルトのテキストエディタが立ち上がるはずです。 コミットするときSVNが無視するべきである `cache/`のサブディレクトリを加えてください:

    *

保存して、終了ください。 これで終わりです。

`log/`ディレクトリのために同じ手順を繰り返してください:

    $ svn propedit svn:ignore log

以下のように入力するだけです:

    *

そして、`cache`と`log`ディレクトリに対して、あなたのウェブサーバがそれらに上書きできるように適切なレベルの書き込み権限をセットしてください。 コマンドラインで:

    $ chmod 777 cache
    $ chmod 777 log

>**注意**: Windowsユーザは、Subversionリポジトリーを管理するのに偉大な[TortoiseSVN][4]クライアントを使用することができます。

ソースバージョンコントロールに関してさらに知りたいなら、symfony bookで [project creation chapter](http://www.symfony-project.com/book/1_0/03-Running-Symfony)をチェックしてください。

>**注意**: askeet SVNリポジトリーは公開されています。 以下から、それにアクセスすることができます。
>
>       http://svn.askeet.com/
>
>さぁどうぞ。チェックアウトしてください。
>
>今日のコードはすでにコミットされていますから、release_day_1タグが見つかります:
>
>       $ svn co http://svn.askeet.com/tags/release_day_1/ askeet/

ではまた、明日
--------------

さて、既に1時間が経ちました。私たちは、たくさん話をしましたが、symfonyのアーリーアダプターには、何も新しいことを示しませんでした。 しかし、symfonyアドベントカレンダーの2日目に明らかにされるものを見てください:

* このアプリケーションで何をするか 
* データモデルを構築し、O/Rマッピングを作成する 
* 足場となるモジュールを作成する

その間、最新のaskeetニュースを受け取りたいなら、[askeet mailing-listに加入](mailto:askeet-subscribe@symfony-project.com)するか、[専用のフォーラム](http://www.symfony-project.com/forum/index.php/f/8/)にてどうぞ。

また、きっと明日！

[1]: http://pear.php.net                  "Pear"
[3]: http://subversion.tigris.org/        "Subversion"
[4]: http://tortoisesvn.tigris.org/       "TortoiseSVN"