Giorno 16: Inviare ~email|Email~
================================

Ogni volta che l'account di un affiliato viene attivato da un amministratore,
un'email deve essere inviata per confermare la sottoscrizione e fornire
il token.

PHP ha diverse buone librerie per l'invio di email, come
[SwiftMailer](http://www.swiftmailer.org/),
[Zend_Mail](http://framework.zend.com/), e
[ezcMail](http://ezcomponents.org/docs/tutorials/Mail). Poiché useremo
alcune altre librerie di ~Zend Framework~ nel futuro, scegliamo `Zend_Mail`
per inviare le nostre email.



### Inviare le email

Modifichiamo l'azione `activate`:

    [php]
    // apps/backend/modules/affiliate/actions/actions.class.php
    class affiliateActions extends autoAffiliateActions
    {
      public function executeListActivate()
      {
        $affiliate = $this->getRoute()->getObject();
        $affiliate->activate();

        // invia un'email all'affiliato
        ProjectConfiguration::registerZend();
        $mail = new Zend_Mail();
        $mail->setBodyText(<<<EOF
    Your Jobeet affiliate account has been activated.

    Your token is {$affiliate->getToken()}.

    The Jobeet Bot.
    EOF
    );
        $mail->setFrom('jobeet@example.com', 'Jobeet Bot');
        $mail->addTo($affiliate->getEmail());
        $mail->setSubject('Jobeet affiliate token');
        $mail->send();

<propel>
        $this->redirect('@jobeet_affiliate');
</propel>
<doctrine>
        $this->redirect('@jobeet_affiliate_affiliate');
</doctrine>
      }

      // ...
    }

Per far funzionare il codice, occorre cambiare `jobeet@example.com` in un
indirizzo email esistente.

>**NOTE**
>Un tutorial completo sulla libreria `Zend_Mail` è disponibile sul
>[sito di Zend Framework](http://framework.zend.com/manual/en/zend.mail.html).